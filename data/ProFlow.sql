
/* Drop Tables */

DROP TABLE IF EXISTS ANEXOS;
DROP TABLE IF EXISTS ATRIBUICAO;
DROP TABLE IF EXISTS ATIVIDADE;
DROP TABLE IF EXISTS DATA_OBJECT_ATTR;
DROP TABLE IF EXISTS ATTR_TYPE;
DROP TABLE IF EXISTS CATEGORIA_GRUPO;
DROP TABLE IF EXISTS CATEGORIA;
DROP TABLE IF EXISTS GRUPO_USUARIO_PARTICIPANTE;
DROP TABLE IF EXISTS PERFIL_ACESSO_USUARIO;
DROP TABLE IF EXISTS EVENTO;
DROP TABLE IF EXISTS PROCESSO;
DROP TABLE IF EXISTS USUARIO;
DROP TABLE IF EXISTS CIDADE;
DROP TABLE IF EXISTS PARTICIPANTE_PROCESSO_ATIVIDADE;
DROP TABLE IF EXISTS RESTRICAO;
DROP TABLE IF EXISTS TRANSICAO;
DROP TABLE IF EXISTS CONTEXTO_ATIVIDADE;
DROP TABLE IF EXISTS CONTEXTO_PROCESSO;
DROP TABLE IF EXISTS DATA_OBJECT;
DROP TABLE IF EXISTS DEPARTAMENTO;
DROP TABLE IF EXISTS ESTADO_PROCESSO;
DROP TABLE IF EXISTS GRUPO;
DROP TABLE IF EXISTS UF;
DROP TABLE IF EXISTS PAIS;
DROP TABLE IF EXISTS PARTICIPANTE;
DROP TABLE IF EXISTS PERFIL_ACESSO;
DROP TABLE IF EXISTS TIPO_EVENTO;




/* Create Tables */

CREATE TABLE ANEXOS
(
	ID SERIAL NOT NULL UNIQUE,
	ID_PROCESSO INT NOT NULL,
	NOME VARCHAR(255) NOT NULL,
	MIMETYPE VARCHAR(50) NOT NULL,
	TAMANHO INT NOT NULL,
	PATH VARCHAR(512) NOT NULL,
	ID_RESPONSAVEL INT NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE ATIVIDADE
(
	ID SERIAL NOT NULL UNIQUE,
	ID_CONTEXTO_ATIVIDADE INT NOT NULL,
	ID_PROCESSO INT NOT NULL,
	ID_ATRIBUICAO_ATUAL NUMERIC NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE ATRIBUICAO
(
	ID NUMERIC NOT NULL UNIQUE,
	ID_ATIVIDADE INT NOT NULL,
	ID_RESPONSAVEL INT NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE ATTR_TYPE
(
	ID SERIAL NOT NULL UNIQUE,
	NOME VARCHAR(20) NOT NULL UNIQUE,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE CATEGORIA
(
	ID SERIAL NOT NULL UNIQUE,
	NOME VARCHAR(100) NOT NULL UNIQUE,
	STATUS_TUPLA BIT VARYING DEFAULT '1' NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE CATEGORIA_GRUPO
(
	ID SERIAL NOT NULL UNIQUE,
	ID_CATEGORIA INT NOT NULL,
	ID_GRUPO INT NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE CIDADE
(
	ID SERIAL NOT NULL UNIQUE,
	NOME VARCHAR(100) NOT NULL,
	ID_UF INT NOT NULL,
	STATUS_TUPLA BIT(1) DEFAULT '1' NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE CONTEXTO_ATIVIDADE
(
	ID SERIAL NOT NULL UNIQUE,
	ID_PROCESSO INT NOT NULL,
	NOME VARCHAR(255) NOT NULL UNIQUE,
	DESCRICAO TEXT NOT NULL,
	EVENTO_FINAL_COMPLETO BIT DEFAULT '0' NOT NULL,
	EVENTO_TERMINAL BIT DEFAULT '0' NOT NULL,
	EVENTO_CANCELADOR BIT DEFAULT '0' NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE CONTEXTO_PROCESSO
(
	ID SERIAL NOT NULL UNIQUE,
	ID_DATA_OBJECT INT NOT NULL,
	NOME VARCHAR(255) NOT NULL UNIQUE,
	DESCRICAO TEXT NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE DATA_OBJECT
(
	ID SERIAL NOT NULL UNIQUE,
	NOME VARCHAR(100) NOT NULL UNIQUE,
	DESCRICAO TEXT NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE DATA_OBJECT_ATTR
(
	ID SERIAL NOT NULL UNIQUE,
	ID_DATA_OBJECT INT NOT NULL,
	ID_TYPE INT NOT NULL,
	NULO BIT VARYING(1) DEFAULT '0' NOT NULL,
	DEFAULT_VALUE VARCHAR(1000),
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE DEPARTAMENTO
(
	ID SERIAL NOT NULL,
	NOME VARCHAR(100) NOT NULL UNIQUE,
	SIGLA VARCHAR(20) UNIQUE,
	ID_SUBORDINADO_A INT,
	STATUS_TUPLA BIT VARYING DEFAULT '1' NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE ESTADO_PROCESSO
(
	ID SERIAL NOT NULL UNIQUE,
	NOME VARCHAR(30) NOT NULL UNIQUE,
	FINALIZA BIT DEFAULT '0' NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE EVENTO
(
	ID SERIAL NOT NULL UNIQUE,
	ID_PROCESSO INT NOT NULL,
	ID_TIPO_EVENTO INT NOT NULL,
	DATAHORA TIMESTAMP NOT NULL,
	VALOR_ANTERIOR VARCHAR(500) NOT NULL,
	VALOR_ATUAL VARCHAR(500) NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE GRUPO
(
	ID SERIAL NOT NULL UNIQUE,
	NOME VARCHAR(100) NOT NULL UNIQUE,
	DESCRICAO VARCHAR(512),
	STATUS_TUPLA BIT VARYING DEFAULT '1' NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE GRUPO_USUARIO_PARTICIPANTE
(
	ID SERIAL NOT NULL UNIQUE,
	ID_GRUPO INT NOT NULL,
	ID_USUARIO INT NOT NULL,
	ID_PARTICIPANTE INT NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE PAIS
(
	ID SERIAL NOT NULL UNIQUE,
	NOME VARCHAR(100) NOT NULL UNIQUE,
	STATUS_TUPLA BIT(1) DEFAULT '1' NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE PARTICIPANTE
(
	ID SERIAL NOT NULL UNIQUE,
	NOME VARCHAR(100) NOT NULL UNIQUE,
	DESCRICAO TEXT,
	STATUS_TUPLA BIT VARYING(1) DEFAULT '1' NOT NULL,
	TIPO VARCHAR(32),
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE PARTICIPANTE_PROCESSO_ATIVIDADE
(
	ID SERIAL NOT NULL UNIQUE,
	ID_PARTICIPANTE INT NOT NULL,
	ID_ATIVIDADE INT NOT NULL,
	ID_PROCESSO INT NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE PERFIL_ACESSO
(
	ID SERIAL NOT NULL UNIQUE,
	NOME VARCHAR(100) NOT NULL UNIQUE,
	SYSNAME VARCHAR(20) NOT NULL UNIQUE,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE PERFIL_ACESSO_USUARIO
(
	ID SERIAL NOT NULL UNIQUE,
	ID_USUARIO INT NOT NULL,
	ID_PERFIL_ACESSO INT NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE PROCESSO
(
	ID SERIAL NOT NULL UNIQUE,
	ID_CONTEXTO_PROCESSO INT NOT NULL,
	ID_SOLICITANTE INT NOT NULL,
	ID_ESTADO INT NOT NULL,
	TITULO VARCHAR(255) NOT NULL,
	DESCRICAO TEXT NOT NULL,
	PRIORIDADE INT NOT NULL,
	STATUS_TUPLA BIT DEFAULT '1' NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE RESTRICAO
(
	ID SERIAL NOT NULL UNIQUE,
	ID_TRANSICAO INT NOT NULL,
	TIPO VARCHAR(30) NOT NULL,
	LOGICA VARCHAR(1000),
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE TIPO_EVENTO
(
	ID SERIAL NOT NULL UNIQUE,
	NOME TEXT NOT NULL UNIQUE,
	DESCRICAO TEXT,
	TPL_VALOR_ANTIGO VARCHAR(255) NOT NULL,
	TPL_VALOR_NOVO VARCHAR(255) NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE TRANSICAO
(
	ID SERIAL NOT NULL UNIQUE,
	ID_ORIGEM INT NOT NULL,
	ID_DESTINO INT NOT NULL,
	ID_PROCESSO INT NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE UF
(
	ID SERIAL NOT NULL UNIQUE,
	SIGLA VARCHAR(2) NOT NULL UNIQUE,
	NOME VARCHAR(100) NOT NULL UNIQUE,
	ID_PAIS INT NOT NULL,
	STATUS_TUPLA BIT(1) DEFAULT '1' NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE USUARIO
(
	ID SERIAL NOT NULL UNIQUE,
	LOGIN VARCHAR(30) NOT NULL UNIQUE,
	SENHA VARCHAR(128) NOT NULL,
	NOME VARCHAR(100) NOT NULL,
	SOBRENOME VARCHAR(100) NOT NULL,
	CARGO VARCHAR(100),
	ENDERECO VARCHAR(512),
	NUMERO VARCHAR(10),
	COMPLEMENTO VARCHAR(100),
	BAIRRO VARCHAR(100),
	CEP VARCHAR(10),
	TELEFONE VARCHAR(14) NOT NULL,
	EMAIL VARCHAR(100) NOT NULL,
	ID_PAIS INT,
	ID_UF INT,
	ID_CIDADE INT,
	ID_DEPARTAMENTO INT,
	STATUS_TUPLA BIT(1) DEFAULT '1' NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;



/* Create Foreign Keys */

ALTER TABLE ATRIBUICAO
	ADD FOREIGN KEY (ID_ATIVIDADE)
	REFERENCES ATIVIDADE (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE DATA_OBJECT_ATTR
	ADD FOREIGN KEY (ID_TYPE)
	REFERENCES ATTR_TYPE (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE CATEGORIA_GRUPO
	ADD FOREIGN KEY (ID_CATEGORIA)
	REFERENCES CATEGORIA (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE USUARIO
	ADD FOREIGN KEY (ID_CIDADE)
	REFERENCES CIDADE (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE ATIVIDADE
	ADD FOREIGN KEY (ID_CONTEXTO_ATIVIDADE)
	REFERENCES CONTEXTO_ATIVIDADE (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PARTICIPANTE_PROCESSO_ATIVIDADE
	ADD FOREIGN KEY (ID_ATIVIDADE)
	REFERENCES CONTEXTO_ATIVIDADE (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE TRANSICAO
	ADD FOREIGN KEY (ID_DESTINO)
	REFERENCES CONTEXTO_ATIVIDADE (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE TRANSICAO
	ADD FOREIGN KEY (ID_ORIGEM)
	REFERENCES CONTEXTO_ATIVIDADE (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE CONTEXTO_ATIVIDADE
	ADD FOREIGN KEY (ID_PROCESSO)
	REFERENCES CONTEXTO_PROCESSO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PARTICIPANTE_PROCESSO_ATIVIDADE
	ADD FOREIGN KEY (ID_PROCESSO)
	REFERENCES CONTEXTO_PROCESSO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PROCESSO
	ADD FOREIGN KEY (ID_CONTEXTO_PROCESSO)
	REFERENCES CONTEXTO_PROCESSO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE TRANSICAO
	ADD FOREIGN KEY (ID_PROCESSO)
	REFERENCES CONTEXTO_PROCESSO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE CONTEXTO_PROCESSO
	ADD FOREIGN KEY (ID_DATA_OBJECT)
	REFERENCES DATA_OBJECT (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE DATA_OBJECT_ATTR
	ADD FOREIGN KEY (ID_DATA_OBJECT)
	REFERENCES DATA_OBJECT (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE DEPARTAMENTO
	ADD FOREIGN KEY (ID_SUBORDINADO_A)
	REFERENCES DEPARTAMENTO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE USUARIO
	ADD FOREIGN KEY (ID_DEPARTAMENTO)
	REFERENCES DEPARTAMENTO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PROCESSO
	ADD FOREIGN KEY (ID_ESTADO)
	REFERENCES ESTADO_PROCESSO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE CATEGORIA_GRUPO
	ADD FOREIGN KEY (ID_GRUPO)
	REFERENCES GRUPO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE GRUPO_USUARIO_PARTICIPANTE
	ADD FOREIGN KEY (ID_GRUPO)
	REFERENCES GRUPO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE UF
	ADD FOREIGN KEY (ID_PAIS)
	REFERENCES PAIS (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE USUARIO
	ADD FOREIGN KEY (ID_PAIS)
	REFERENCES PAIS (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE GRUPO_USUARIO_PARTICIPANTE
	ADD FOREIGN KEY (ID_PARTICIPANTE)
	REFERENCES PARTICIPANTE (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PARTICIPANTE_PROCESSO_ATIVIDADE
	ADD FOREIGN KEY (ID_PARTICIPANTE)
	REFERENCES PARTICIPANTE (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PERFIL_ACESSO_USUARIO
	ADD FOREIGN KEY (ID_PERFIL_ACESSO)
	REFERENCES PERFIL_ACESSO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE ANEXOS
	ADD FOREIGN KEY (ID_PROCESSO)
	REFERENCES PROCESSO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE ATIVIDADE
	ADD FOREIGN KEY (ID_PROCESSO)
	REFERENCES PROCESSO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE EVENTO
	ADD FOREIGN KEY (ID_PROCESSO)
	REFERENCES PROCESSO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE EVENTO
	ADD FOREIGN KEY (ID_TIPO_EVENTO)
	REFERENCES TIPO_EVENTO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE RESTRICAO
	ADD FOREIGN KEY (ID_TRANSICAO)
	REFERENCES TRANSICAO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE CIDADE
	ADD FOREIGN KEY (ID_UF)
	REFERENCES UF (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE USUARIO
	ADD FOREIGN KEY (ID_UF)
	REFERENCES UF (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE ANEXOS
	ADD FOREIGN KEY (ID_RESPONSAVEL)
	REFERENCES USUARIO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE ATRIBUICAO
	ADD FOREIGN KEY (ID_RESPONSAVEL)
	REFERENCES USUARIO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE GRUPO_USUARIO_PARTICIPANTE
	ADD FOREIGN KEY (ID_USUARIO)
	REFERENCES USUARIO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PERFIL_ACESSO_USUARIO
	ADD FOREIGN KEY (ID_USUARIO)
	REFERENCES USUARIO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PROCESSO
	ADD FOREIGN KEY (ID_SOLICITANTE)
	REFERENCES USUARIO (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;



INSERT INTO perfil_acesso VALUES (1, 'Super Usuário', 'root');
INSERT INTO perfil_acesso VALUES (2, 'Administrador do Sistema', 'admin');
INSERT INTO perfil_acesso VALUES (3, 'Designer de Processos', 'designer');
INSERT INTO perfil_acesso VALUES (4, 'Participante de Processos', 'participant');
